<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flexible Question Viewer</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --border-color: #ccc;
      --pane-bg: #f9f9f9;
      --resizer-color: #ddd;
      --highlight-color: #e0e0e0;
    }

    body.dark-mode {
      --bg-color: #121212;
      --text-color: #ffffff;
      --border-color: #444;
      --pane-bg: #1e1e1e;
      --resizer-color: #555;
      --highlight-color: #333;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    .filters, .layout-toggle {
      display: flex;
      gap: 1em;
      padding: 1em;
      flex-wrap: wrap;
    }

    select, button {
      padding: 0.5em;
      font-size: 1em;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1em;
      font-size: 1em;
    }

    th, td {
      border: 1px solid var(--border-color);
      padding: 0.6em;
      text-align: left;
    }

    th {
      background-color: var(--highlight-color);
    }

    .resizable-grid {
      display: flex;
      height: 60vh;
      min-height: 300px;
    }

    .pane {
      flex: 1;
      overflow: auto;
      padding: 1em;
      background-color: var(--pane-bg);
    }

    .resizer {
      width: 6px;
      cursor: col-resize;
      background-color: var(--resizer-color);
    }

    .vertical {
      width: 100%;
      height: 6px;
      cursor: row-resize;
    }

    .question-header {
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 0.5em;
    }

    .dark-toggle {
      position: absolute;
      top: 1em;
      right: 1em;
      padding: 0.5em 1em;
      background: var(--highlight-color);
      color: var(--text-color);
      border: none;
      cursor: pointer;
    }

    .back-btn {
      margin-bottom: 1em;
      padding: 0.4em 0.8em;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .resizable-grid {
        flex-direction: column;
        height: auto;
      }

      .pane {
        border-bottom: 1px solid var(--border-color);
      }

      .resizer {
        height: 6px;
        width: 100%;
        cursor: row-resize;
      }

      table {
        font-size: 0.9em;
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }

      th, td {
        padding: 0.8em;
      }

      .filters {
        flex-direction: column;
      }

      .dark-toggle {
        top: 1em;
        right: 1em;
      }

      .layout-toggle {
        flex-direction: column;
        gap: 0.5em;
      }

      .back-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <button class="dark-toggle" onclick="toggleDarkMode()">üåô</button>
  <div class="filters">
    <select id="listFilter" onchange="applyFilters()">
      <option value="">All Lists</option>
    </select>
    <select id="langFilter" onchange="applyFilters()">
      <option value="">All Languages</option>
    </select>
    <select id="diffFilter" onchange="applyFilters()">
      <option value="">All Difficulties</option>
    </select>
  </div>
  <div class="layout-toggle">
    <button onclick="toggleSection('question')">üìù Question</button>
    <button onclick="toggleSection('code')">üíª Code</button>
    <button onclick="toggleSection('explanation')">üìñ Explanation</button>
  </div>
  <div id="table-container">
    <table id="questionsTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Title</th>
          <th>List</th>
          <th>Lang</th>
          <th>Diff</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="resizable-grid" id="resizable-grid">
    <div class="pane" id="pane-question"></div>
    <div class="resizer" id="resizer1"></div>
    <div class="pane" id="pane-code"></div>
    <div class="resizer" id="resizer2"></div>
    <div class="pane" id="pane-explanation"></div>
  </div>

  <script>
    let allData = [];

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    function applyFilters() {
      const listVal = document.getElementById('listFilter').value;
      const langVal = document.getElementById('langFilter').value;
      const diffVal = document.getElementById('diffFilter').value;

      const filtered = allData.filter(row => {
        return (!listVal || row.lists.includes(listVal)) &&
               (!langVal || row["code language"] === langVal) &&
               (!diffVal || row.difficulty === diffVal);
      });

      renderTable(filtered);
    }

    function renderTable(data) {
      const tbody = document.querySelector("#questionsTable tbody");
      tbody.innerHTML = "";

      data.forEach((row, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td><a href="#" onclick="showDetails(${idx}); return false;">${row["question header"]}</a></td>
          <td>${row.lists}</td>
          <td>${row["code language"]}</td>
          <td>${row.difficulty}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function populateFilters(data) {
      const lists = new Set();
      const langs = new Set();
      const diffs = new Set();

      data.forEach(row => {
        row.lists.split(",").forEach(l => lists.add(l.trim()));
        langs.add(row["code language"]);
        diffs.add(row.difficulty);
      });

      for (const set of [
        [lists, "listFilter"],
        [langs, "langFilter"],
        [diffs, "diffFilter"]
      ]) {
        const [values, id] = set;
        const select = document.getElementById(id);
        values.forEach(val => {
          const opt = document.createElement("option");
          opt.value = val;
          opt.text = val;
          select.appendChild(opt);
        });
      }
    }

    function showDetails(index) {
      const row = allData[index];
      document.getElementById("pane-question").innerHTML = `<div class='question-header'>${row["question header"]}</div>${row.question}<br><a href='${row["problem link"]}' target='_blank'>üîó Problem Link</a>`;
      document.getElementById("pane-code").innerText = row.code;
      document.getElementById("pane-explanation").innerText = row.explanation;
    }

    function toggleSection(section) {
      const panes = {
        question: document.getElementById("pane-question"),
        code: document.getElementById("pane-code"),
        explanation: document.getElementById("pane-explanation"),
      };

      Object.keys(panes).forEach(key => {
        panes[key].style.display = (key === section || panes[key].style.display === "none") ? "block" : "none";
      });
    }

    function initResize(resizer, paneA, paneB) {
      let startX, startY, startWidthA, startHeightA;
      const vertical = resizer.classList.contains("vertical");

      resizer.addEventListener("mousedown", function (e) {
        startX = e.clientX;
        startY = e.clientY;
        startWidthA = paneA.offsetWidth;
        startHeightA = paneA.offsetHeight;

        function onMouseMove(e) {
          if (vertical) {
            const dy = e.clientY - startY;
            paneA.style.flex = `0 0 ${startHeightA + dy}px`;
          } else {
            const dx = e.clientX - startX;
            paneA.style.flex = `0 0 ${startWidthA + dx}px`;
          }
        }

        function onMouseUp() {
          document.removeEventListener("mousemove", onMouseMove);
          document.removeEventListener("mouseup", onMouseUp);
        }

        document.addEventListener("mousemove", onMouseMove);
        document.addEventListener("mouseup", onMouseUp);
      });
    }

    Papa.parse("data/questions.csv", {
      download: true,
      header: true,
      complete: function (results) {
        allData = results.data;
        renderTable(allData);
        populateFilters(allData);
      }
    });

    window.onload = () => {
      if (localStorage.getItem("darkMode") === "true") {
        document.body.classList.add("dark-mode");
      }

      const isMobile = window.innerWidth <= 768;
      const resizer1 = document.getElementById("resizer1");
      const resizer2 = document.getElementById("resizer2");

      if (isMobile) {
        resizer1.classList.add("vertical");
        resizer2.classList.add("vertical");
      }

      initResize(resizer1, document.getElementById("pane-question"), document.getElementById("pane-code"));
      initResize(resizer2, document.getElementById("pane-code"), document.getElementById("pane-explanation"));
    };
  </script>
</body>
</html>
