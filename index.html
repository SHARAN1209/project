<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flexible Question Viewer</title>
    
    <!-- Tailwind Configuration -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'gradient': 'gradient 8s linear infinite',
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        'gradient': {
                            '0%, 100%': {
                                'background-size': '200% 200%',
                                'background-position': 'left center'
                            },
                            '50%': {
                                'background-size': '200% 200%',
                                'background-position': 'right center'
                            }
                        },
                        'shimmer': {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(100%)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Application Styles -->
    <style>
        /* Base Styles */
        .split-pane {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 0;
            min-height: 300px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transform: translateZ(0);
            perspective: 1000px;
        }

        /* Mobile-first styles */
        @media (max-width: 768px) {
            .split-pane {
                width: 100% !important;
                min-height: 250px;
            }

            .split-pane:not(.full-width) {
                flex: none;
            }
        }

        /* Desktop styles */
        @media (min-width: 769px) {
            .split-pane {
                flex: 1;
            }

            .split-pane:hover {
                transform: translateY(-2px) translateZ(0);
            }
        }

        .full-width {
            width: 100% !important;
        }

        /* Dark Mode Enhancements */
        .dark .text-enhancement {
            color: #f1f5f9;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .dark .heading-enhancement {
            color: #f8fafc;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        .dark .text-muted {
            color: #94a3b8;
        }

        /* Modern Glass Effects */
        .glass-effect {
            background: rgba(240, 249, 255, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(56, 189, 248, 0.1);
            transform: translateZ(0);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-effect:hover {
            background: rgba(240, 249, 255, 0.8);
            transform: translateY(-2px) translateZ(0);
            border: 1px solid rgba(56, 189, 248, 0.2);
        }

        .dark .glass-effect {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(6, 182, 212, 0.1);
        }

        .dark .glass-effect:hover {
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(6, 182, 212, 0.2);
        }

        /* Enhanced Card Effects */
        .card-3d {
            transform-style: preserve-3d;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            perspective: 1000px;
            transform: translateZ(0);
        }

        .card-3d:hover {
            transform: translateY(-5px) rotateX(1deg) rotateY(1deg) translateZ(0);
            box-shadow: 
                0 25px 50px -12px rgba(14, 165, 233, 0.15),
                0 8px 16px -4px rgba(14, 165, 233, 0.1);
        }

        .dark .card-3d:hover {
            box-shadow: 
                0 25px 50px -12px rgba(6, 182, 212, 0.2),
                0 8px 16px -4px rgba(6, 182, 212, 0.1);
        }

        .card-hover {
            transition: all 0.3s ease;
            background: rgba(254, 254, 254, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(14, 165, 233, 0.1);
        }

        .dark .card-hover {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(6, 182, 212, 0.1);
        }

        .card-hover:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px -8px rgba(14, 165, 233, 0.15);
            border: 1px solid rgba(14, 165, 233, 0.2);
        }

        .dark .card-hover:hover {
            background: rgba(15, 23, 42, 0.95);
            box-shadow: 0 20px 40px -8px rgba(6, 182, 212, 0.2);
            border: 1px solid rgba(6, 182, 212, 0.2);
        }

        /* Modern Animations */
        .animate-fade-in {
            animation: enhanced-fade-in 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes enhanced-fade-in {
            0% { 
                opacity: 0;
                transform: translateY(20px) translateZ(-10px);
            }
            100% { 
                opacity: 1;
                transform: translateY(0) translateZ(0);
            }
        }

        @keyframes float {
            0% { transform: translateY(0) translateZ(0); }
            50% { transform: translateY(-5px) translateZ(0); }
            100% { transform: translateY(0) translateZ(0); }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes pulse-subtle {
            0% { transform: scale(1) translateZ(0); }
            50% { transform: scale(1.01) translateZ(0); }
            100% { transform: scale(1) translateZ(0); }
        }

        .pulse-on-hover:hover {
            animation: pulse-subtle 2s ease-in-out infinite;
        }

        /* Enhanced Interactive Elements */
        .button-3d {
            transform: translateZ(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .button-3d:hover {
            transform: translateY(-2px) translateZ(0);
            box-shadow: 0 12px 24px -6px rgba(6, 182, 212, 0.4);
        }

        .button-3d:active {
            transform: translateY(0) translateZ(0);
            box-shadow: 0 6px 12px -3px rgba(6, 182, 212, 0.3);
        }

        /* Modern Progress Bar */
        .progress-animate {
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(90deg, #06b6d4 0%, #0ea5e9 50%, #3b82f6 100%);
            background-size: 200% 200%;
            animation: gradient 3s ease infinite;
            transform: translateZ(0);
            box-shadow: 0 3px 12px -2px rgba(6, 182, 212, 0.4);
        }

        .dark .progress-animate {
            background: linear-gradient(90deg, #06b6d4 0%, #0ea5e9 50%, #3b82f6 100%);
            box-shadow: 0 3px 12px -2px rgba(6, 182, 212, 0.6);
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Enhanced Form Elements */
        .custom-checkbox {
            appearance: none;
            width: 1.2em;
            height: 1.2em;
            border: 2px solid #0ea5e9;
            border-radius: 6px;
            margin-right: 0.5em;
            position: relative;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateZ(0);
        }

        .custom-checkbox:checked {
            background: linear-gradient(135deg, #06b6d4, #0ea5e9);
            animation: checkmark-3d 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 3px 10px -2px rgba(6, 182, 212, 0.5);
        }

        .dark .custom-checkbox {
            border-color: #06b6d4;
        }

        .dark .custom-checkbox:checked {
            background: linear-gradient(135deg, #06b6d4, #0ea5e9);
            box-shadow: 0 3px 10px -2px rgba(6, 182, 212, 0.6);
        }

        @keyframes checkmark-3d {
            0% { transform: scale(1) translateZ(0); }
            50% { transform: scale(1.15) translateZ(10px); }
            100% { transform: scale(1) translateZ(0); }
        }

        /* Enhanced Table Styles */
        tbody tr {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateZ(0);
        }

        tbody tr:hover {
            transform: translateX(5px) translateZ(0);
            background: rgba(240, 249, 255, 0.8);
            box-shadow: -5px 0 15px -5px rgba(14, 165, 233, 0.2);
        }

        .dark tbody tr:hover {
            background: rgba(6, 182, 212, 0.1);
            box-shadow: -5px 0 15px -5px rgba(6, 182, 212, 0.3);
        }

        /* Modern Loading Effects */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .loading-shimmer {
            background: linear-gradient(
                90deg,
                rgba(240, 249, 255, 0.1),
                rgba(240, 249, 255, 0.3),
                rgba(240, 249, 255, 0.1)
            );
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }

        .dark .loading-shimmer {
            background: linear-gradient(
                90deg,
                rgba(6, 182, 212, 0.1),
                rgba(6, 182, 212, 0.2),
                rgba(6, 182, 212, 0.1)
            );
        }

        /* Enhanced focus states */
        .focus-ring:focus {
            outline: none;
            ring: 2px;
            ring-color: #06b6d4;
            ring-offset: 2px;
        }

        .dark .focus-ring:focus {
            ring-color: #06b6d4;
        }

        /* Enhanced content styling */
        .content-section {
            transition: all 0.3s ease;
        }

        .content-section pre {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace;
            line-height: 1.6;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }

        /* Code editor styling */
        .code-editor {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
            border: 1px solid #374151 !important;
            color: #e2e8f0 !important;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .dark .code-editor {
            background: linear-gradient(135deg, #020617 0%, #0f172a 100%) !important;
            border: 1px solid #1f2937 !important;
            color: #f1f5f9 !important;
        }

        .light .code-editor {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
            color: #e2e8f0 !important;
        }

        /* Question content styling */
        .question-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        .dark .question-content {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            color: #f1f5f9;
        }

        /* Explanation content styling */
        .explanation-content {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 1px solid #fde68a;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        .dark .explanation-content {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            color: #f1f5f9;
        }

        /* Improved typography */
        .enhanced-text {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            letter-spacing: 0.025em;
        }

        /* Code highlighting improvements */
        .syntax-highlighted {
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Scrollbar styling for code blocks */
        .code-scroll::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }

        .code-scroll::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .code-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .code-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Force code editor styling */
        #code-pre {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
            color: #e2e8f0;  /* Remove !important to allow syntax highlighting to override */
            border: 1px solid #374151 !important;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace !important;
            font-size: 14px !important;
            line-height: 1.6 !important;
            padding: 24px !important;
            margin: 0 !important;
            border-radius: 0 0 12px 12px !important;
        }

        .dark #code-pre {
            background: linear-gradient(135deg, #020617 0%, #0f172a 100%) !important;
            color: #f1f5f9;  /* Remove !important to allow syntax highlighting to override */
            border: 1px solid #1f2937 !important;
        }

        /* Code syntax span styling */
        #code-pre span {
            font-family: inherit !important;
        }

        /* Ensure code container has no conflicting styles */
        #code-content {
            background: none !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        /* Syntax highlighting classes */
        .code-comment {
            color: #6b7280 !important;
            font-style: italic !important;
            opacity: 0.9 !important;
        }

        .code-string {
            color: #fbbf24 !important;
            font-weight: 500 !important;
        }

        .code-keyword-blue {
            color: #3b82f6 !important;
            font-weight: 700 !important;
        }

        .code-keyword-purple {
            color: #8b5cf6 !important;
            font-weight: 700 !important;
        }

        .code-type {
            color: #10b981 !important;
            font-weight: 600 !important;
        }

        .code-control {
            color: #ef4444 !important;
            font-weight: 600 !important;
        }

        .code-boolean {
            color: #f59e0b !important;
            font-weight: 600 !important;
        }

        .code-number {
            color: #ec4899 !important;
            font-weight: 500 !important;
        }

        .code-method {
            color: #06b6d4 !important;
            font-weight: 500 !important;
        }

        /* Ensure all syntax spans inherit font family */
        #code-pre .code-comment,
        #code-pre .code-string,
        #code-pre .code-keyword-blue,
        #code-pre .code-keyword-purple,
        #code-pre .code-type,
        #code-pre .code-control,
        #code-pre .code-boolean,
        #code-pre .code-number,
        #code-pre .code-method {
            font-family: inherit !important;
        }

        /* Fullscreen syntax highlighting - Light Mode */
        .code-comment-fullscreen {
            color: #64748b !important;
            font-style: italic !important;
            opacity: 0.9 !important;
        }

        .dark .code-comment-fullscreen {
            color: #6b7280 !important;
        }

        .code-string-fullscreen {
            color: #d97706 !important;
            font-weight: 500 !important;
        }

        .dark .code-string-fullscreen {
            color: #fbbf24 !important;
        }

        .code-keyword-blue-fullscreen {
            color: #2563eb !important;
            font-weight: 700 !important;
        }

        .dark .code-keyword-blue-fullscreen {
            color: #3b82f6 !important;
        }

        .code-keyword-purple-fullscreen {
            color: #7c3aed !important;
            font-weight: 700 !important;
        }

        .dark .code-keyword-purple-fullscreen {
            color: #8b5cf6 !important;
        }

        .code-type-fullscreen {
            color: #059669 !important;
            font-weight: 600 !important;
        }

        .dark .code-type-fullscreen {
            color: #10b981 !important;
        }

        .code-control-fullscreen {
            color: #dc2626 !important;
            font-weight: 600 !important;
        }

        .dark .code-control-fullscreen {
            color: #ef4444 !important;
        }

        .code-boolean-fullscreen {
            color: #ca8a04 !important;
            font-weight: 600 !important;
        }

        .dark .code-boolean-fullscreen {
            color: #f59e0b !important;
        }

        .code-number-fullscreen {
            color: #be185d !important;
            font-weight: 500 !important;
        }

        .dark .code-number-fullscreen {
            color: #ec4899 !important;
        }

        .code-method-fullscreen {
            color: #0891b2 !important;
            font-weight: 500 !important;
        }

        .dark .code-method-fullscreen {
            color: #06b6d4 !important;
        }

        /* Question text formatting classes */
        .question-heading {
            color: #2563eb !important;
            font-size: 1.1em !important;
            font-weight: 700 !important;
        }

        .dark .question-heading {
            color: #60a5fa !important;
        }

        .question-keyword {
            color: #059669 !important;
            font-weight: 600 !important;
        }

        .dark .question-keyword {
            color: #34d399 !important;
        }

        .question-code {
            background: rgba(59, 130, 246, 0.1) !important;
            color: #2563eb !important;
            padding: 2px 6px !important;
            border-radius: 4px !important;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace !important;
            font-size: 0.9em !important;
            font-weight: 500 !important;
        }

        .dark .question-code {
            background: rgba(96, 165, 250, 0.2) !important;
            color: #93c5fd !important;
        }

        /* Explanation text formatting classes */
        .explanation-heading {
            color: #d97706 !important;
            font-size: 1.1em !important;
            font-weight: 700 !important;
        }

        .dark .explanation-heading {
            color: #fbbf24 !important;
        }

        .explanation-complexity {
            color: #dc2626 !important;
            font-weight: 600 !important;
        }

        .dark .explanation-complexity {
            color: #f87171 !important;
        }

        .explanation-step {
            color: #7c3aed !important;
            font-weight: 600 !important;
        }

        .dark .explanation-step {
            color: #a78bfa !important;
        }

        .explanation-code {
            background: rgba(217, 119, 6, 0.1) !important;
            color: #d97706 !important;
            padding: 2px 6px !important;
            border-radius: 4px !important;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace !important;
            font-size: 0.9em !important;
            font-weight: 500 !important;
        }

        .dark .explanation-code {
            background: rgba(251, 191, 36, 0.2) !important;
            color: #fcd34d !important;
        }

        /* Fullscreen modal styles */
        #fullscreen-modal {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Fullscreen modal theme adaptation */
        #fullscreen-modal {
            background: rgba(0, 0, 0, 0.8);
        }

        .dark #fullscreen-modal {
            background: rgba(0, 0, 0, 0.9);
        }

        /* Fullscreen header theme adaptation */
        .fullscreen-header {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(16px);
            display: none !important; /* Hide header in fullscreen for distraction-free reading */
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
        }

        .dark .fullscreen-header {
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .fullscreen-header h2 {
            color: #1e293b;
        }

        .dark .fullscreen-header h2 {
            color: #f1f5f9;
        }

        .fullscreen-header button {
            background: rgba(0, 0, 0, 0.1);
            color: #1e293b;
        }

        .fullscreen-header button:hover {
            background: rgba(0, 0, 0, 0.2);
        }

        .dark .fullscreen-header button {
            background: rgba(255, 255, 255, 0.1);
            color: #f1f5f9;
        }

        .dark .fullscreen-header button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Fullscreen language badge */
        .fullscreen-language-badge {
            background: rgba(59, 130, 246, 0.2);
            color: #1e40af;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .dark .fullscreen-language-badge {
            background: rgba(96, 165, 250, 0.2);
            color: #93c5fd;
            border: 1px solid rgba(96, 165, 250, 0.3);
        }

        #fullscreen-content {
            line-height: 1.7;
        }

        /* Fullscreen content styling - Light Mode */
        pre.fullscreen-question {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 2.5rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 1.1rem;
            line-height: 1.8;
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #1e293b;
            max-width: 100%;
            margin: 0 auto;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .dark pre.fullscreen-question {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #f1f5f9;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        pre.fullscreen-code {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 2.5rem;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace;
            font-size: 1rem;
            line-height: 1.6;
            border: 1px solid rgba(0, 0, 0, 0.1);
            overflow-x: auto;
            color: #1e293b;
            max-width: 100%;
            margin: 0 auto;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            white-space: pre;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .dark pre.fullscreen-code {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        pre.fullscreen-explanation {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-radius: 16px;
            padding: 2.5rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 1.1rem;
            line-height: 1.8;
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #1e293b;
            max-width: 100%;
            margin: 0 auto;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .dark pre.fullscreen-explanation {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #f1f5f9;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        /* Make content sections clickable */
        .content-clickable {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .content-clickable:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.3);
        }

        .content-clickable:hover::after {
            content: "üîç Click to expand fullscreen";
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            pointer-events: none;
            z-index: 10;
            animation: fadeIn 0.2s ease-out;
        }

        /* Fullscreen container alignment */
        #fullscreen-content {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            min-height: 100%;
            padding: 2rem;
            box-sizing: border-box;
        }

        #fullscreen-content > div {
            width: 100%;
            max-width: 1200px;
        }

        /* Fullscreen scrollbar styling - Light Mode */
        #fullscreen-content::-webkit-scrollbar {
            width: 12px;
        }

        #fullscreen-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 6px;
        }

        #fullscreen-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
        }

        #fullscreen-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        /* Dark mode scrollbar */
        .dark #fullscreen-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        .dark #fullscreen-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
        }

        .dark #fullscreen-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Responsive fullscreen content */
        @media (max-width: 768px) {
            #fullscreen-content {
                padding: 1rem;
            }
            
            pre.fullscreen-question,
            pre.fullscreen-code,
            pre.fullscreen-explanation {
                padding: 1.5rem;
                font-size: 1rem;
            }
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-sky-50 via-white to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 transition-colors duration-500">
    <!-- Header -->
    <header class="fixed top-0 left-0 w-full glass-effect z-10 px-6 py-4">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold bg-gradient-to-r from-sky-600 via-cyan-500 to-blue-500 dark:from-cyan-400 dark:via-sky-300 dark:to-cyan-300 text-transparent bg-clip-text animate-gradient heading-enhancement">
                XYZ
            </h1>
            <button class="bg-gradient-to-r from-sky-500 via-cyan-500 to-blue-600 dark:from-cyan-500 dark:via-sky-400 dark:to-cyan-400 px-4 py-2 rounded-xl text-white shadow-lg hover:shadow-xl transition-all duration-300 button-3d focus-ring" 
                    onclick="toggleDarkMode()">
                üåì
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-24 px-4 max-w-6xl mx-auto space-y-8 min-h-screen pb-24">
        <!-- List Page -->
        <div id="list-page" class="page animate-fade-in">
            <h2 class="text-3xl font-bold mb-8 bg-gradient-to-r from-sky-600 via-cyan-500 to-blue-500 dark:from-cyan-400 dark:via-sky-300 dark:to-cyan-300 text-transparent bg-clip-text heading-enhancement">
                ABC...
            </h2>

            <!-- Progress Section -->
            <div class="bg-white/90 dark:bg-slate-900/90 rounded-2xl p-6 shadow-lg card-hover card-3d mb-8 border border-sky-100 dark:border-cyan-800">
                <div class="flex items-center justify-between mb-3">
                    <label class="font-semibold text-lg text-sky-800 dark:text-cyan-200 text-enhancement">Progress</label>
                    <button onclick="resetProgress()" 
                            class="text-red-500 dark:text-red-400 hover:text-red-600 dark:hover:text-red-300 transition-colors duration-300 button-3d focus-ring">
                        Reset Progress
                    </button>
                </div>
                <div class="w-full bg-sky-100 dark:bg-slate-700 rounded-full h-4 overflow-hidden">
                    <div id="progress-slider" class="progress-animate h-4 rounded-full"></div>
                </div>
                <p id="progress-text" class="text-sm mt-2 text-sky-600 dark:text-cyan-300"></p>
            </div>

            <!-- Filters Section -->
            <div class="bg-white/90 dark:bg-slate-900/90 rounded-2xl p-6 shadow-lg card-hover card-3d mb-8 border border-sky-100 dark:border-cyan-800">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="space-y-2">
                        <label class="font-semibold text-sky-700 dark:text-cyan-200">Topic</label>
                        <select id="topic-filter" onchange="renderTable()"
                                class="w-full rounded-xl p-3 border border-sky-200 dark:border-cyan-700 bg-white dark:bg-slate-800 text-sky-800 dark:text-cyan-100 focus:ring-2 focus:ring-sky-500 dark:focus:ring-cyan-400 transition-all focus-ring">
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="font-semibold text-sky-700 dark:text-cyan-200">Difficulty</label>
                        <select id="difficulty-filter" onchange="renderTable()"
                                class="w-full rounded-xl p-3 border border-sky-200 dark:border-cyan-700 bg-white dark:bg-slate-800 text-sky-800 dark:text-cyan-100 focus:ring-2 focus:ring-sky-500 dark:focus:ring-cyan-400 transition-all focus-ring">
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="font-semibold text-sky-700 dark:text-cyan-200">List</label>
                        <select id="list-filter" onchange="renderTable()"
                                class="w-full rounded-xl p-3 border border-sky-200 dark:border-cyan-700 bg-white dark:bg-slate-800 text-sky-800 dark:text-cyan-100 focus:ring-2 focus:ring-sky-500 dark:focus:ring-cyan-400 transition-all focus-ring">
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="resetFilters()" 
                                class="text-red-500 dark:text-red-400 hover:text-red-600 dark:hover:text-red-300 transition-colors duration-300 button-3d focus-ring">
                            Reset Filters
                        </button>
                    </div>
                </div>
            </div>

            <!-- Questions Table -->
            <div class="bg-white/90 dark:bg-slate-900/90 rounded-2xl shadow-lg card-hover card-3d overflow-hidden border border-sky-100 dark:border-cyan-800">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-sky-50 dark:bg-slate-800 border-b border-sky-100 dark:border-cyan-700">
                            <tr>
                                <th class="px-6 py-4 text-left font-semibold text-sky-700 dark:text-cyan-200">Status</th>
                                <th class="px-6 py-4 text-left font-semibold text-sky-700 dark:text-cyan-200">Topic</th>
                                <th class="px-6 py-4 text-left font-semibold text-sky-700 dark:text-cyan-200">Question</th>
                                <th class="px-6 py-4 text-left font-semibold text-sky-700 dark:text-cyan-200">Difficulty</th>
                                <th class="px-6 py-4 text-left font-semibold text-sky-700 dark:text-cyan-200">List</th>
                            </tr>
                        </thead>
                        <tbody id="question-table-body" class="divide-y divide-sky-100 dark:divide-cyan-700">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Detail Page -->
        <div id="detail-page" class="hidden space-y-6 animate-fade-in">
            <!-- Navigation Header -->
            <div class="flex justify-between items-center">
                <button class="bg-gradient-to-r from-sky-500 via-cyan-500 to-blue-600 dark:from-cyan-500 dark:via-sky-400 dark:to-cyan-400 px-6 py-3 rounded-xl text-white shadow-lg hover:shadow-xl transition-all duration-300 flex items-center gap-2 button-3d focus-ring" 
                        onclick="goBack()">
                    <span class="text-lg">‚Üê</span>
                    <span>Back to List</span>
                </button>
                
                <!-- Question Navigation -->
                <div class="flex items-center gap-3">
                    <button id="prev-question" onclick="navigateQuestion(-1)" 
                            class="p-2 rounded-lg bg-sky-100 dark:bg-slate-700 text-sky-600 dark:text-cyan-400 hover:bg-sky-200 dark:hover:bg-slate-600 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                            title="Previous question (Ctrl+‚Üê)">
                        <span class="text-lg">‚óÄ</span>
                    </button>
                    <span id="question-counter" class="text-sm font-medium text-sky-600 dark:text-cyan-400 px-3"></span>
                    <button id="next-question" onclick="navigateQuestion(1)" 
                            class="p-2 rounded-lg bg-sky-100 dark:bg-slate-700 text-sky-600 dark:text-cyan-400 hover:bg-sky-200 dark:hover:bg-slate-600 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                            title="Next question (Ctrl+‚Üí)">
                        <span class="text-lg">‚ñ∂</span>
                    </button>
                    <button onclick="toggleShortcutsHelp()" 
                            class="p-2 rounded-lg bg-sky-100 dark:bg-slate-700 text-sky-600 dark:text-cyan-400 hover:bg-sky-200 dark:hover:bg-slate-600 transition-all duration-300"
                            title="Keyboard shortcuts">
                        <span>‚å®Ô∏è</span>
                    </button>
                </div>
            </div>

            <!-- Question Header Card -->
            <div class="bg-white/90 dark:bg-slate-900/90 rounded-2xl p-6 shadow-lg card-hover card-3d border border-sky-100 dark:border-cyan-800">
                <!-- Title and External Link -->
                <div class="flex justify-between items-start mb-4">
                    <h1 id="question-title" class="text-3xl font-bold bg-gradient-to-r from-sky-600 via-cyan-500 to-blue-500 dark:from-cyan-400 dark:via-sky-300 dark:to-cyan-300 text-transparent bg-clip-text heading-enhancement flex-1"></h1>
                    <div class="flex items-center gap-3 ml-4">
                        <button id="bookmark-btn" onclick="toggleBookmark()" 
                                class="p-2 rounded-lg bg-sky-100 dark:bg-slate-700 text-sky-600 dark:text-cyan-400 hover:bg-sky-200 dark:hover:bg-slate-600 transition-all duration-300"
                                title="Bookmark this question (Ctrl+B)">
                            <span id="bookmark-icon">üîñ</span>
                        </button>
                        <a id="external-link" href="#" target="_blank" 
                           class="p-2 rounded-lg bg-sky-100 dark:bg-slate-700 text-sky-600 dark:text-cyan-400 hover:bg-sky-200 dark:hover:bg-slate-600 transition-all duration-300"
                           title="Open original problem">
                            üîó
                        </a>
                    </div>
                </div>

                <!-- Metadata Badges -->
                <div class="flex flex-wrap items-center gap-3 mb-6">
                    <span id="difficulty-badge" class="px-3 py-1 rounded-full text-sm font-medium"></span>
                    <span id="topic-badge" class="px-3 py-1 rounded-full text-sm font-medium bg-sky-100 dark:bg-slate-700 text-sky-700 dark:text-cyan-300"></span>
                    <span id="language-badge" class="px-3 py-1 rounded-full text-sm font-medium bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300"></span>
                    <span id="completion-badge" class="px-3 py-1 rounded-full text-sm font-medium hidden"></span>
                    <div id="tags-container" class="flex flex-wrap gap-2"></div>
                </div>

                <!-- View Controls -->
                <div class="flex flex-wrap gap-6 mb-6 p-4 bg-sky-50 dark:bg-slate-800 rounded-xl">
                    <label class="flex items-center cursor-pointer text-sky-800 dark:text-cyan-200 hover:text-sky-600 dark:hover:text-cyan-100 transition-colors">
                        <input type="checkbox" checked onchange="togglePane('question')" class="custom-checkbox">
                        <span class="flex items-center gap-2">
                            <span>üìã</span>
                            <span>Question</span>
                        </span>
                    </label>
                    <label class="flex items-center cursor-pointer text-sky-800 dark:text-cyan-200 hover:text-sky-600 dark:hover:text-cyan-100 transition-colors">
                        <input type="checkbox" onchange="togglePane('code')" class="custom-checkbox">
                        <span class="flex items-center gap-2">
                            <span>üíª</span>
                            <span>Code</span>
                        </span>
                    </label>
                    <label class="flex items-center cursor-pointer text-sky-800 dark:text-cyan-200 hover:text-sky-600 dark:hover:text-cyan-100 transition-colors">
                        <input type="checkbox" onchange="togglePane('explanation')" class="custom-checkbox">
                        <span class="flex items-center gap-2">
                            <span>üí°</span>
                            <span>Explanation</span>
                        </span>
                    </label>
                </div>

                <!-- Content Grid -->
                <div id="content-grid" class="flex flex-col lg:flex-row gap-6 min-h-[400px]">
                    <!-- Question Pane -->
                    <div id="pane-question" class="split-pane full-width transform transition-all duration-300 bg-white/95 dark:bg-slate-800/95 rounded-xl shadow-lg hover:shadow-xl border border-sky-100 dark:border-cyan-700">
                        <div class="flex items-center justify-between p-4 border-b border-sky-100 dark:border-cyan-700">
                            <h3 class="font-semibold text-sky-700 dark:text-cyan-300 flex items-center gap-2">
                                <span>üìã</span>
                                <span>Problem Statement</span>
                            </h3>
                        </div>
                        <div class="p-6 content-section">
                            <div id="question-content" class="prose prose-sky dark:prose-invert max-w-none content-clickable" onclick="openFullscreen('question')">
                                <pre class="whitespace-pre-wrap leading-relaxed text-base question-content enhanced-text p-6 rounded-xl shadow-sm"></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Code Pane -->
                    <div id="pane-code" class="split-pane hidden transform transition-all duration-300 bg-white/95 dark:bg-slate-800/95 rounded-xl shadow-lg hover:shadow-xl border border-sky-100 dark:border-cyan-700">
                        <div class="flex items-center justify-between p-4 border-b border-sky-100 dark:border-cyan-700 bg-slate-100 dark:bg-slate-800">
                            <h3 class="font-semibold text-sky-700 dark:text-cyan-300 flex items-center gap-2">
                                <span>üíª</span>
                                <span>Solution Code</span>
                                <span id="code-language-display" class="text-xs px-2 py-1 rounded bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300"></span>
                            </h3>
                            <button onclick="copyCode()" 
                                    class="flex items-center gap-2 px-3 py-1 text-xs bg-sky-100 dark:bg-slate-700 text-sky-600 dark:text-cyan-400 rounded-lg hover:bg-sky-200 dark:hover:bg-slate-600 transition-all"
                                    title="Copy code to clipboard (Ctrl+Shift+C)">
                                <span>üìã</span>
                                <span>Copy</span>
                            </button>
                        </div>
                        <div class="p-0">
                            <div id="code-content" class="relative content-clickable" onclick="openFullscreen('code')">
                                <pre id="code-pre" class="whitespace-pre font-mono text-sm leading-relaxed code-editor p-6 rounded-none rounded-b-xl overflow-x-auto shadow-inner font-medium code-scroll m-0 border-0"></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Explanation Pane -->
                    <div id="pane-explanation" class="split-pane hidden transform transition-all duration-300 bg-white/95 dark:bg-slate-800/95 rounded-xl shadow-lg hover:shadow-xl border border-sky-100 dark:border-cyan-700">
                        <div class="flex items-center justify-between p-4 border-b border-sky-100 dark:border-cyan-700">
                            <h3 class="font-semibold text-sky-700 dark:text-cyan-300 flex items-center gap-2">
                                <span>üí°</span>
                                <span>Explanation & Analysis</span>
                            </h3>
                        </div>
                        <div class="p-6 content-section">
                            <div id="explanation-content" class="prose prose-amber dark:prose-invert max-w-none content-clickable" onclick="openFullscreen('explanation')">
                                <pre class="whitespace-pre-wrap leading-relaxed text-base explanation-content enhanced-text p-6 rounded-xl shadow-sm"></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Keyboard Shortcuts Help Modal -->
        <div id="shortcuts-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-md w-full p-6 animate-fade-in">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-sky-800 dark:text-cyan-200">‚å®Ô∏è Keyboard Shortcuts</h3>
                    <button onclick="toggleShortcutsHelp()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <span class="text-xl">√ó</span>
                    </button>
                </div>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600 dark:text-gray-300">Navigate Previous</span>
                        <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl + ‚Üê</kbd>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600 dark:text-gray-300">Navigate Next</span>
                        <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl + ‚Üí</kbd>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600 dark:text-gray-300">Back to List</span>
                        <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Esc</kbd>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600 dark:text-gray-300">Toggle Bookmark</span>
                        <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl + B</kbd>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600 dark:text-gray-300">Copy Code</span>
                        <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl + Shift + C</kbd>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600 dark:text-gray-300">Fullscreen View</span>
                        <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Click Content</kbd>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fullscreen Content Modal -->
        <div id="fullscreen-modal" class="fixed inset-0 backdrop-blur-sm z-[60] hidden" onclick="closeFullscreen()">
            <div class="h-full flex flex-col relative" onclick="event.stopPropagation()">
                <!-- Fullscreen Header (Hidden) -->
                <div class="fullscreen-header flex items-center justify-between p-6">
                    <div class="flex items-center gap-4">
                        <span id="fullscreen-icon" class="text-2xl"></span>
                        <h2 id="fullscreen-title" class="text-xl font-bold"></h2>
                        <span id="fullscreen-language" class="px-3 py-1 text-sm rounded-full hidden fullscreen-language-badge"></span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button id="fullscreen-copy" onclick="copyFullscreenContent()" 
                                class="hidden px-4 py-2 rounded-lg transition-all duration-300 flex items-center gap-2">
                            <span>üìã</span>
                            <span>Copy</span>
                        </button>
                        <button onclick="closeFullscreen()" 
                                class="p-2 rounded-lg transition-all duration-300" 
                                title="Close (Esc)">
                            <span class="text-xl">√ó</span>
                        </button>
                    </div>
                </div>
                
                <!-- Invisible Close Button for clean exit -->
                <button onclick="closeFullscreen()" 
                        class="absolute top-4 right-4 z-10 p-3 rounded-full bg-black/20 hover:bg-black/40 transition-all duration-300 text-white/80 hover:text-white" 
                        title="Close (Esc or Click)">
                    <span class="text-xl font-bold">√ó</span>
                </button>
                
                <!-- Fullscreen Content -->
                <div class="h-full overflow-auto p-8">
                    <div id="fullscreen-content" class="max-w-none"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="w-full py-12 px-4 mt-auto bg-white/90 dark:bg-slate-900/90 border-t border-sky-100 dark:border-cyan-800">
        <div class="max-w-6xl mx-auto">
            <div class="flex flex-col items-center space-y-4">
                <div class="flex space-x-4 text-sky-600 dark:text-cyan-400">
                    <span>¬© 2025</span>
                    <span class="text-sky-400 dark:text-cyan-600">|</span>
                    <span>All rights reserved</span>
                </div>
                <div class="text-sm text-sky-500 dark:text-cyan-500">
                    Made with ‚ù§Ô∏è for learners
                </div>
            </div>
        </div>
    </footer>

    <!-- Application Scripts -->
    <script>
        // Data Storage
        const data = [];

        // Utility Functions
        function parseCSV(text) {
            const [headerLine, ...lines] = text.trim().split('\n');
            const headers = headerLine.split(',').map(h => h.trim());
            return lines.map(line => {
                const values = line.split(',').map(v => v.trim());
                return headers.reduce((obj, header, i) => {
                    obj[header] = values[i] || '';
                    return obj;
                }, {});
            });
        }

        function fetchText(url) {
            return fetch(url).then(res => res.ok ? res.text() : 'Error loading');
        }

        function escapeHTML(str) {
            return str.replace(/[&<>"']/g, tag => (
                { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[tag]
            ));
        }

        // Status Management
        function getStatusMap() {
            return JSON.parse(localStorage.getItem('questionStatus') || '{}');
        }

        function saveStatusMap(map) {
            localStorage.setItem('questionStatus', JSON.stringify(map));
        }

        function updateProgress() {
            const checkboxes = document.querySelectorAll('.status-checkbox');
            const total = checkboxes.length;
            const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
            const percent = total > 0 ? Math.round((checked / total) * 100) : 0;

            document.getElementById('progress-text').textContent = `${checked}/${total} (${percent}%) completed`;
            const slider = document.getElementById('progress-slider');
            slider.style.width = percent + '%';
        }

        // Reset Functions
        function resetProgress() {
            if (!confirm('Are you sure you want to reset all progress?')) return;
            localStorage.removeItem('questionStatus');
            renderTable();
        }

        function resetFilters() {
            localStorage.removeItem('topicFilter');
            localStorage.removeItem('difficultyFilter');
            localStorage.removeItem('listFilter');

            document.getElementById('topic-filter').value = '';
            document.getElementById('difficulty-filter').value = '';
            document.getElementById('list-filter').value = '';

            renderTable();
        }

        // Rendering Functions
        function renderFilters() {
            const topicSet = new Set(data.map(d => d.topic));
            const diffSet = new Set(data.map(d => d.difficulty));
            const listSet = new Set();

            data.forEach(d => {
                if (d.lists) {
                    d.lists.split('|').map(s => s.trim()).forEach(tag => listSet.add(tag));
                }
            });

            const topicFilter = document.getElementById('topic-filter');
            const diffFilter = document.getElementById('difficulty-filter');
            const listFilter = document.getElementById('list-filter');

            topicFilter.innerHTML = '<option value="">All</option>' + [...topicSet].map(t => `<option value="${t}">${t}</option>`).join('');
            diffFilter.innerHTML = '<option value="">All</option>' + [...diffSet].map(d => `<option value="${d}">${d}</option>`).join('');
            listFilter.innerHTML = '<option value="">All</option>' + [...listSet].map(l => `<option value="${l}">${l}</option>`).join('');

            // Restore saved filter values
            topicFilter.value = localStorage.getItem('topicFilter') || '';
            diffFilter.value = localStorage.getItem('difficultyFilter') || '';
            listFilter.value = localStorage.getItem('listFilter') || '';
        }

        function renderTable() {
            const topicVal = document.getElementById('topic-filter').value;
            const diffVal = document.getElementById('difficulty-filter').value;
            const listVal = document.getElementById('list-filter').value;

            // Save filter values
            localStorage.setItem('topicFilter', topicVal);
            localStorage.setItem('difficultyFilter', diffVal);
            localStorage.setItem('listFilter', listVal);

            const statusMap = getStatusMap();
            const tbody = document.getElementById('question-table-body');
            tbody.innerHTML = '';

            data.forEach((item, idx) => {
                const listTags = (item.lists || '').split('|').map(s => s.trim());
                if ((topicVal && item.topic !== topicVal) ||
                    (diffVal && item.difficulty !== diffVal) ||
                    (listVal && !listTags.includes(listVal))) return;

                const id = `q-${idx}`;
                const checked = statusMap[id] || false;
                const tr = document.createElement('tr');
                tr.className = "hover:bg-sky-50 dark:hover:bg-cyan-900/20 cursor-pointer text-sky-800 dark:text-cyan-200";
                tr.innerHTML = `
                    <td class="px-4 py-2">
                        <input type="checkbox" class="status-checkbox custom-checkbox" data-id="${id}" ${checked ? 'checked' : ''} onclick="event.stopPropagation();">
                    </td>
                    <td class="px-4 py-2 font-medium">${item.topic}</td>
                    <td class="px-4 py-2">${item["question header"]}</td>
                    <td class="px-4 py-2 font-medium">${item.difficulty}</td>
                    <td class="px-4 py-2 text-sky-600 dark:text-cyan-300">${item.lists || ''}</td>
                `;
                tr.addEventListener('click', () => showDetail(idx));
                tbody.appendChild(tr);
            });

            document.querySelectorAll('.status-checkbox').forEach(cb => {
                cb.addEventListener('change', function () {
                    const map = getStatusMap();
                    map[this.dataset.id] = this.checked;
                    saveStatusMap(map);
                    updateProgress();
                });
            });

            updateProgress();
        }

        // Global variables for detail view
        let currentQuestionIndex = 0;
        let bookmarkedQuestions = JSON.parse(localStorage.getItem('bookmarkedQuestions') || '[]');

        // Detail View Functions
        function showDetail(index) {
            currentQuestionIndex = index;
            const item = data[index];
            
            // Update basic info
            document.getElementById('question-title').textContent = item["question header"];
            document.getElementById('external-link').href = item["problem link"];
            
            // Update metadata badges
            updateMetadataBadges(item);
            
            // Update navigation
            updateNavigationButtons();
            
            // Update bookmark status
            updateBookmarkButton();
            
            // Load content with enhanced formatting
            fetchText(item.question).then(t => {
                const questionPre = document.querySelector('#question-content pre');
                questionPre.innerHTML = formatQuestionText(escapeHTML(t));
            });
            
            fetchText(item.code).then(t => {
                const codeContent = document.querySelector('#code-pre');
                // Apply syntax highlighting (which handles HTML escaping internally)
                const highlightedCode = applySyntaxHighlighting(t, item["code language"]);
                codeContent.innerHTML = highlightedCode;
                document.getElementById('code-language-display').textContent = item["code language"];
                
                // Ensure code editor styling is applied and wait for DOM to be ready
                setTimeout(() => {
                    codeContent.style.setProperty('background', 'linear-gradient(135deg, #0f172a 0%, #1e293b 100%)', 'important');
                    codeContent.style.setProperty('border', '1px solid #374151', 'important');
                    codeContent.style.setProperty('font-family', '"SF Mono", "Monaco", "Inconsolata", "Roboto Mono", "Source Code Pro", monospace', 'important');
                    // Don't override color - let syntax highlighting classes handle colors
                }, 100);
            });
            
            fetchText(item.explanation).then(t => {
                const explanationPre = document.querySelector('#explanation-content pre');
                explanationPre.innerHTML = formatExplanationText(escapeHTML(t));
            });

            // Reset view controls
            document.querySelector("input[onchange*=question]").checked = true;
            document.querySelector("input[onchange*=code]").checked = false;
            document.querySelector("input[onchange*=explanation]").checked = false;

            togglePane('question');
            togglePane('code');
            togglePane('explanation');

            document.getElementById('list-page').classList.add('hidden');
            document.getElementById('detail-page').classList.remove('hidden');
        }

        function updateMetadataBadges(item) {
            // Difficulty badge
            const difficultyBadge = document.getElementById('difficulty-badge');
            const difficulty = item.difficulty.toLowerCase();
            difficultyBadge.textContent = item.difficulty;
            difficultyBadge.className = `px-3 py-1 rounded-full text-sm font-medium ${getDifficultyClasses(difficulty)}`;
            
            // Topic badge
            document.getElementById('topic-badge').textContent = item.topic;
            
            // Language badge
            document.getElementById('language-badge').textContent = item["code language"];
            
            // Completion status
            const completionBadge = document.getElementById('completion-badge');
            const statusMap = getStatusMap();
            const questionId = `q-${currentQuestionIndex}`;
            if (statusMap[questionId]) {
                completionBadge.textContent = '‚úÖ Completed';
                completionBadge.className = 'px-3 py-1 rounded-full text-sm font-medium bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300';
                completionBadge.classList.remove('hidden');
            } else {
                completionBadge.classList.add('hidden');
            }
            
            // Tags
            const tagsContainer = document.getElementById('tags-container');
            tagsContainer.innerHTML = '';
            if (item.lists) {
                const tags = item.lists.split('|').map(tag => tag.trim());
                tags.forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'px-2 py-1 text-xs rounded-full bg-cyan-100 dark:bg-cyan-900 text-cyan-700 dark:text-cyan-300';
                    tagElement.textContent = tag;
                    tagsContainer.appendChild(tagElement);
                });
            }
        }

        function getDifficultyClasses(difficulty) {
            switch(difficulty) {
                case 'easy': return 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300';
                case 'medium': return 'bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300';
                case 'hard': return 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300';
                default: return 'bg-gray-100 dark:bg-gray-900 text-gray-700 dark:text-gray-300';
            }
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-question');
            const nextBtn = document.getElementById('next-question');
            const counter = document.getElementById('question-counter');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === data.length - 1;
            counter.textContent = `${currentQuestionIndex + 1} of ${data.length}`;
        }

        function navigateQuestion(direction) {
            const newIndex = currentQuestionIndex + direction;
            if (newIndex >= 0 && newIndex < data.length) {
                showDetail(newIndex);
            }
        }

        function updateBookmarkButton() {
            const bookmarkBtn = document.getElementById('bookmark-btn');
            const bookmarkIcon = document.getElementById('bookmark-icon');
            const questionId = `q-${currentQuestionIndex}`;
            
            if (bookmarkedQuestions.includes(questionId)) {
                bookmarkIcon.textContent = 'üîñ';
                bookmarkBtn.classList.add('bg-yellow-100', 'dark:bg-yellow-900', 'text-yellow-600', 'dark:text-yellow-400');
            } else {
                bookmarkIcon.textContent = 'üîñ';
                bookmarkBtn.classList.remove('bg-yellow-100', 'dark:bg-yellow-900', 'text-yellow-600', 'dark:text-yellow-400');
            }
        }

        function toggleBookmark() {
            const questionId = `q-${currentQuestionIndex}`;
            const index = bookmarkedQuestions.indexOf(questionId);
            
            if (index > -1) {
                bookmarkedQuestions.splice(index, 1);
            } else {
                bookmarkedQuestions.push(questionId);
            }
            
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarkedQuestions));
            updateBookmarkButton();
        }

        function copyCode() {
            const codeElement = document.querySelector('#code-pre');
            const text = codeElement.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                // Show feedback
                const copyBtn = document.querySelector('button[onclick="copyCode()"]');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span>‚úÖ</span><span>Copied!</span>';
                copyBtn.classList.add('bg-green-100', 'dark:bg-green-900', 'text-green-600', 'dark:text-green-400');
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.classList.remove('bg-green-100', 'dark:bg-green-900', 'text-green-600', 'dark:text-green-400');
                }, 2000);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            });
        }

        function applyFullscreenSyntaxHighlighting(code, language) {
            if (language.toLowerCase() === 'java') {
                return tokenizeAndHighlightJava(code, true);
            }
            return escapeHTML(code);
        }

        function applySyntaxHighlighting(code, language) {
            if (language.toLowerCase() === 'java') {
                return tokenizeAndHighlightJava(code, false);
            }
            return escapeHTML(code);
        }

        function tokenizeAndHighlightJava(code, isFullscreen) {
            // Clean approach: tokenize first, then apply highlighting
            const suffix = isFullscreen ? '-fullscreen' : '';
            
            // First escape HTML entities
            let escapedCode = code
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');

            // Define token patterns in order of priority
            const patterns = [
                { type: 'comment', regex: /\/\/.*$/gm },
                { type: 'comment', regex: /\/\*[\s\S]*?\*\//g },
                { type: 'string', regex: /&quot;[^&quot;]*&quot;/g },
                { type: 'keyword-blue', regex: /\b(public|private|protected|static|final)\b/g },
                { type: 'keyword-purple', regex: /\b(class|interface|import|package|extends|implements)\b/g },
                { type: 'type', regex: /\b(int|String|boolean|void|char|long|double|float|Integer|Boolean|Set|HashSet|List|ArrayList|Map|HashMap)\b/g },
                { type: 'control', regex: /\b(if|else|for|while|return|new|this|try|catch|throw)\b/g },
                { type: 'boolean', regex: /\b(true|false|null)\b/g },
                { type: 'number', regex: /\b\d+\b/g },
                { type: 'method', regex: /\b\w+(?=\s*\()/g }
            ];

            // Create a list of all tokens with their positions
            let tokens = [];
            
            patterns.forEach(pattern => {
                let match;
                while ((match = pattern.regex.exec(escapedCode)) !== null) {
                    tokens.push({
                        type: pattern.type,
                        value: match[0],
                        start: match.index,
                        end: match.index + match[0].length
                    });
                }
                // Reset regex lastIndex for next pattern
                pattern.regex.lastIndex = 0;
            });

            // Sort tokens by position and remove overlaps
            tokens.sort((a, b) => a.start - b.start);
            
            // Remove overlapping tokens (keep first occurrence)
            let cleanTokens = [];
            let lastEnd = 0;
            
            tokens.forEach(token => {
                if (token.start >= lastEnd) {
                    cleanTokens.push(token);
                    lastEnd = token.end;
                }
            });

            // Build the highlighted string
            let result = '';
            let currentPos = 0;

            cleanTokens.forEach(token => {
                // Add any text before this token
                if (token.start > currentPos) {
                    result += escapedCode.substring(currentPos, token.start);
                }
                
                // Add the highlighted token
                result += `<span class="code-${token.type}${suffix}">${token.value}</span>`;
                currentPos = token.end;
            });

            // Add any remaining text
            if (currentPos < escapedCode.length) {
                result += escapedCode.substring(currentPos);
            }

            return result;
        }

        function formatQuestionText(text) {
            // Enhanced formatting for question text
            return text
                // Make headings bold
                .replace(/^([A-Z][^:]+:)/gm, '<strong class="question-heading">$1</strong>')
                // Highlight constraints and examples
                .replace(/\b(Input:|Output:|Example:|Constraints:|Note:)/gi, '<strong class="question-keyword">$1</strong>')
                // Format code snippets in questions
                .replace(/`([^`]+)`/g, '<code class="question-code">$1</code>');
        }

        function formatExplanationText(text) {
            // Enhanced formatting for explanation text
            return text
                // Make section headings bold and colored
                .replace(/^([A-Z][^:]+:)/gm, '<strong class="explanation-heading">$1</strong>')
                // Highlight time and space complexity
                .replace(/(Time Complexity:|Space Complexity:)/gi, '<strong class="explanation-complexity">$1</strong>')
                // Format algorithm steps
                .replace(/^\d+\./gm, '<strong class="explanation-step">$&</strong>')
                // Format code references
                .replace(/`([^`]+)`/g, '<code class="explanation-code">$1</code>');
        }

        // Fullscreen functionality
        let fullscreenContent = '';
        let fullscreenType = '';

        function openFullscreen(type) {
            const modal = document.getElementById('fullscreen-modal');
            const content = document.getElementById('fullscreen-content');
            
            fullscreenType = type;
            
            // Get content from the respective pane and preserve formatting
            let sourceContent = '';
            if (type === 'question') {
                sourceContent = document.querySelector('#question-content pre').innerHTML;
                content.innerHTML = `<pre class="fullscreen-question">${sourceContent}</pre>`;
            } else if (type === 'code') {
                // For code, get the original text and apply clean syntax highlighting
                const codeText = document.querySelector('#code-pre').textContent;
                const language = document.getElementById('code-language-display').textContent;
                sourceContent = applyFullscreenSyntaxHighlighting(codeText, language);
                content.innerHTML = `<pre class="fullscreen-code">${sourceContent}</pre>`;
            } else if (type === 'explanation') {
                sourceContent = document.querySelector('#explanation-content pre').innerHTML;
                content.innerHTML = `<pre class="fullscreen-explanation">${sourceContent}</pre>`;
            }
            
            fullscreenContent = sourceContent;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeFullscreen() {
            const modal = document.getElementById('fullscreen-modal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
            fullscreenContent = '';
            fullscreenType = '';
        }

        function copyFullscreenContent() {
            if (fullscreenType === 'code') {
                // Get text content from the fullscreen pre element
                const fullscreenPre = document.querySelector('pre.fullscreen-code');
                const text = fullscreenPre ? fullscreenPre.textContent : '';
                
                navigator.clipboard.writeText(text).then(() => {
                    // Show feedback
                    const copyBtn = document.getElementById('fullscreen-copy');
                    const originalHTML = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<span>‚úÖ</span><span>Copied!</span>';
                    copyBtn.classList.add('bg-green-500');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHTML;
                        copyBtn.classList.remove('bg-green-500');
                    }, 2000);
                }).catch(() => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                });
            }
        }

        function toggleShortcutsHelp() {
            const modal = document.getElementById('shortcuts-modal');
            modal.classList.toggle('hidden');
        }

        function goBack() {
            document.getElementById('detail-page').classList.add('hidden');
            document.getElementById('list-page').classList.remove('hidden');
        }        function togglePane(type) {
            const pane = document.getElementById(`pane-${type}`);
            const checkbox = document.querySelector(`input[type='checkbox'][onchange*="${type}"]`);
            
            const panes = ['question', 'code', 'explanation'];
            const visiblePanes = panes.filter(p => 
                document.querySelector(`input[type='checkbox'][onchange*="${p}"]`).checked
            );

            // Reset all panes
            panes.forEach(p => {
                const currentPane = document.getElementById(`pane-${p}`);
                currentPane.classList.remove('full-width');
                currentPane.style.width = ''; // Remove any explicit width
                if (!document.querySelector(`input[type='checkbox'][onchange*="${p}"]`).checked) {
                    currentPane.classList.add('hidden');
                } else {
                    currentPane.classList.remove('hidden');
                }
            });

            // Handle layout based on viewport and number of visible panes
            const isMobile = window.innerWidth < 768;
            const contentGrid = document.getElementById('content-grid');

            if (visiblePanes.length === 1) {
                document.getElementById(`pane-${visiblePanes[0]}`).classList.add('full-width');
            } else if (isMobile) {
                // On mobile, all visible panes take full width
                visiblePanes.forEach(paneId => {
                    document.getElementById(`pane-${paneId}`).style.width = '100%';
                });
            } else {
                // On desktop, split width evenly
                const width = `${100 / visiblePanes.length}%`;
                visiblePanes.forEach(paneId => {
                    document.getElementById(`pane-${paneId}`).style.width = width;
                });
            }
        }

        // Theme Functions
        function toggleDarkMode() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark);
        }

        // Initialization
        window.onload = () => {
            if (localStorage.getItem('darkMode') === 'true') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }

            fetch('data/questions.csv')
                .then(res => res.text())
                .then(text => {
                    data.push(...parseCSV(text));
                    renderFilters();
                    renderTable();
                });
        };

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Handle fullscreen modal escape key and copy
            if (!document.getElementById('fullscreen-modal').classList.contains('hidden')) {
                if (e.key === 'Escape') {
                    e.preventDefault();
                    closeFullscreen();
                } else if (e.key === 'c' && (e.ctrlKey || e.metaKey) && e.shiftKey) {
                    e.preventDefault();
                    // Copy fullscreen content based on type
                    const content = document.getElementById('fullscreen-content');
                    const text = content ? content.textContent : '';
                    navigator.clipboard.writeText(text).then(() => {
                        // Brief visual feedback
                        const originalBg = content.style.background;
                        content.style.background = 'rgba(34, 197, 94, 0.2)';
                        setTimeout(() => {
                            content.style.background = originalBg;
                        }, 200);
                    });
                }
                return;
            }
            
            if (document.getElementById('detail-page').classList.contains('hidden')) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        navigateQuestion(-1);
                    }
                    break;
                case 'ArrowRight':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        navigateQuestion(1);
                    }
                    break;
                case 'Escape':
                    e.preventDefault();
                    goBack();
                    break;
                case 'b':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        toggleBookmark();
                    }
                    break;
                case 'c':
                    if ((e.ctrlKey || e.metaKey) && e.shiftKey) {
                        e.preventDefault();
                        if (!document.getElementById('pane-code').classList.contains('hidden')) {
                            copyCode();
                        }
                    }
                    break;
            }
        });

        // Initialize dark mode on load
        window.addEventListener('load', function() {
            // Dark mode is handled in the main onload function
        });
    </script>
</body>
</html>
